# **Проверка Python-скриптов на уязвимости и вредоносный код**

> Простая программа, проверяющая код на опасные функции, например `eval()` или `os.system()`.

---

## 1. **Описание функциональности программы**

Программа позволяет:

-   Проверять код на наличие опасных функций
-   Выбирать файл для проверки (по умолчанию из `./code/*.py`)
-   Вводить код вручную (с предустановленным примером)
-   Переключаться между вкладками (файл/ручной ввод)

---

## 2. **Понимание проблемы**

Некоторые функции Python могут представлять угрозу, если используются без надлежащей проверки:

1. **Инъекциям кода**
   `eval()`, `exec()` – выполняют произвольный код (можно запустить вредоносные команды).
2. **Выполнению произвольных команд**
   `os.system()`, `subprocess.Popen()` – выполняют команды системы.
3. **Доступу к файловой системе**
   `open()`, `shutil.rmtree()`, `os.remove()` – могут удалить файлы.
4. **Загрузка данных**
   `pickle.load()` – при загрузке данных могут выполнить код.

---

## 3.**Использование AST (Abstract Syntax Tree)**

Для статического анализа кода без его выполнения используется модуль `ast`.

Это безопасный способ парсить код и находить опасные узлы, так как **не выполняет код**, а только его анализирует.

### **Как это работает?**

1. Разбираем код в AST (Абстрактное Синтаксическое Дерево).
2. Проходим по узлам дерева и проверяем вызовы функций.
3. Если находим использование опасных функций — сообщаем об этом.

---

## 4. **Ограничения подхода**

1. **Статический анализ** не отследит динамически созданные имена функций (например, `getattr(os, 'system')('ls')`).
2. **Ложные срабатывания**: Не все вызовы `eval()` опасны (но лучше перестраховаться).
3. **Пропущенные угрозы**: Например, использование `pickle` или `yaml.load()`.

---

## 5. **Дополнительные улучшения безопасности для вашего кода**

1. **Проверка аргументов**: Например, если `eval()` вызывается с константой, это менее опасно.
2. **Интеграция с линтерами**: Используйте `flake8` с плагинами, например, `bandit` ([GitHub](https://github.com/PyCQA/bandit)).
3. **Динамический анализ**: Запуск в песочнице (sandbox) для отслеживания поведения.

---

## 6. **Описание работы программы**

1. **Вкладка "Ввод кода"**:

    - Пользователь может вставить или написать код вручную.
    - По умолчанию вставлен пример кода с уязвимостями.

2. **Вкладка "Проверка файла"**:

    - Пользователь выбирает файл из директории `./code` (по умолчанию).
    - Содержимое файла загружается в текстовое поле.
    - После загрузки файла программа автоматически переключится на вкладку "Ввод кода", где будет отображен загруженный код.

3. **Кнопка "Проверить код"**:

    - Анализирует код из вкладки "Ввод кода".
    - Результаты проверки выводятся в поле "Результаты".

4. **Результаты**:

    - Если найдены опасные функции, программа выводит их список с указанием строк.
    - Пользователь может перейти к найденой ошибке кликнув по элементу списка.
    - Если ошибок нет, выводится сообщение "Опасных функций не найдено".
    - Перед каждой проверкой кода старая подсветка удаляется, чтобы избежать наложения подсветки.

---

### **Пример проверки текста**

1. Вставьте код с уязвимостями:

    ```python
    import os
    eval('print("Hello, World!")')
    os.system('ls')
    ```

2. Нажмите "Проверить код".

3. В текстовом поле с кодом строки с `eval` и `os.system` будут выделены желтым фоном.

4. В поле результатов появится сообщение:
    ```
    Строка 2: Использование опасной функции: eval
    Строка 3: Использование опасной функции: os.system
    ```

### **Пример проверки файла**

1. Перейдите на вкладку "Проверка файла".
2. Нажмите "Выбрать файл" и выберите файл с кодом.
3. После выбора файла программа переключится на вкладку "Ввод кода", где будет отображен загруженный код.
4. Нажмите "Проверить код", чтобы увидеть результаты анализа и подсветку уязвимостей.

---

### **Запуск программы**

1. Сохраните код в директорию на жестком диске.
2. Создайте директорию `./code` и добавьте туда Python-файлы для проверки.
3. Запустите программу:
    ```bash
    python main.py
    ```

---

## 7. **Заключение**

Созданный скрипт — это база для статического анализа. Для профессионального использования лучше комбинировать:

1. **Статический анализ** (например, `bandit`, `pylint`).
2. **Динамический анализ** (например, запуск в изолированной среде).
3. **Ручной аудит** для сложных случаев.

---
